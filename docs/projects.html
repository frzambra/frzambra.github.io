<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Francisco Zambrano - Projects – Francisco Zambrano</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/fzb_selfie.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-47708def744f7d6bf9e6ade08d3fbeef.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-27089841b29612b0d4c40f59322fb13d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">


<meta property="og:title" content="Francisco Zambrano - Projects">
<meta property="og:description" content="">
<meta property="og:site_name" content="Francisco Zambrano">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Francisco Zambrano</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-research" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Research</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-research">    
        <li>
    <a class="dropdown-item" href="./publications.html">
 <span class="dropdown-text">Publications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./conferences.html">
 <span class="dropdown-text">Conferences</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./projects.html" aria-current="page"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/frzambra/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/frzambra"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#impact-of-climate-change-on-avocado-phenology-and-native-sclerophyllous-forest-according-to-access-to-potential-groundwater-in-the-aconcagua-river-basin" id="toc-impact-of-climate-change-on-avocado-phenology-and-native-sclerophyllous-forest-according-to-access-to-potential-groundwater-in-the-aconcagua-river-basin" class="nav-link active" data-scroll-target="#impact-of-climate-change-on-avocado-phenology-and-native-sclerophyllous-forest-according-to-access-to-potential-groundwater-in-the-aconcagua-river-basin"><span class="header-section-number">1</span> Impact of climate change on avocado phenology and native sclerophyllous forest according to access to potential groundwater in the Aconcagua River basin</a></li>
  <li><a href="#a-multi-scale-drought-observatory-for-chile-an-early-warning-system-to-mitigate-agricultural-and-ecological-impacts" id="toc-a-multi-scale-drought-observatory-for-chile-an-early-warning-system-to-mitigate-agricultural-and-ecological-impacts" class="nav-link" data-scroll-target="#a-multi-scale-drought-observatory-for-chile-an-early-warning-system-to-mitigate-agricultural-and-ecological-impacts"><span class="header-section-number">2</span> A multi-scale drought observatory for Chile: an early warning system to mitigate agricultural and ecological impacts</a></li>
  <li><a href="#satori-satellite-system-for-irrigation-optimization" id="toc-satori-satellite-system-for-irrigation-optimization" class="nav-link" data-scroll-target="#satori-satellite-system-for-irrigation-optimization"><span class="header-section-number">3</span> SatOri: Satellite System for Irrigation Optimization</a></li>
  <li><a href="#the-impact-of-weather-variability-on-wheat-and-maize-production-an-improved-early-warning-model-for-agricultural-drought" id="toc-the-impact-of-weather-variability-on-wheat-and-maize-production-an-improved-early-warning-model-for-agricultural-drought" class="nav-link" data-scroll-target="#the-impact-of-weather-variability-on-wheat-and-maize-production-an-improved-early-warning-model-for-agricultural-drought"><span class="header-section-number">4</span> The impact of weather variability on wheat and maize production: an improved early warning model for agricultural drought</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="impact-of-climate-change-on-avocado-phenology-and-native-sclerophyllous-forest-according-to-access-to-potential-groundwater-in-the-aconcagua-river-basin" class="level1" data-toc-text="Crea Cienca 2030" data-number="1">
<h1 data-toc-text="Crea Cienca 2030" data-number="1"><span class="header-section-number">1</span> Impact of climate change on avocado phenology and native sclerophyllous forest according to access to potential groundwater in the Aconcagua River basin</h1>
<p><strong>Fund Name:</strong> CREA Ciencia 2030<br>
<strong>Fund Agency:</strong> National Research and Development Agency (ANID)<br>
<strong>Year:</strong> 2025<br>
<strong>Fund total amount:</strong> 5 millions chilean pesos ($CLP)</p>
<section id="abstract" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract">Abstract</h2>
<p>Climate change is having two primary impacts in Chile. First, through the sustained reduction in precipitation, and second, through rising temperatures. Rising temperatures have an impact, first, by increasing vegetation demand for water and second, by shifting vegetation phenological development stages. This has led to a significant reduction in water resources, affecting both ecosystems and agricultural production, especially in the Aconcagua River basin in Chile, where droughts have intensified. This threatens biodiversity and agricultural security, particularly in crops such as avocado, which require up to 18,000 m³/ha annually in certain areas.</p>
<p>To address this problem, a comprehensive system is proposed that combines groundwater zoning with a phenological analysis of avocado orchards and native forests. The goal is to identify the areas most susceptible to water stress and improve water management, increasing the resilience of ecosystems and crops to climate change. Recent research has demonstrated the effectiveness of remote sensing techniques and geographic information systems for mapping groundwater zones; however, gaps persist in our understanding of how vegetation interacts with groundwater, an aspect this project seeks to address. Additionally, various studies have shown that climate change negatively impacts the phenological stages of avocado trees, which points to the importance of efficient water management. The objective of this study is to determine the relationship between potential groundwater zones and the phenology of avocado trees and native sclerophyllous forests in the Aconcagua Basin, using zonation techniques and phenological analysis using remote sensing and artificial intelligence. To this end, a zonation model will be developed using spatial statistics techniques and a predictive artificial intelligence model that will evaluate geomorphometric, hydrological, and spectral variables to categorize productive and unproductive wells and generate a groundwater probability map. The results will enable more effective water management in both agriculture and ecosystem conservation, providing critical information for water use planning in regions affected by scarcity. Furthermore, the results of this work will enable future applications for applied research projects (e.g., FONDEF) aimed at implementing solutions to contribute to water sustainability and the adaptation of agricultural systems and natural ecosystems to climate change.</p>
<hr>
</section>
</section>
<section id="a-multi-scale-drought-observatory-for-chile-an-early-warning-system-to-mitigate-agricultural-and-ecological-impacts" class="level1" data-toc-text="Drought Observatory - ODES" data-number="2">
<h1 data-toc-text="Drought Observatory - ODES" data-number="2"><span class="header-section-number">2</span> A multi-scale drought observatory for Chile: an early warning system to mitigate agricultural and ecological impacts</h1>
<p><strong>Fund Name:</strong> Redes, Estrategia y Conocimiento<br>
<strong>Fund Agency:</strong> National Research and Development Agency (ANID)<br>
<strong>Year:</strong> 2021<br>
<strong>Fund total amount:</strong> 300 millions chilean pesos ($CLP)</p>
<section id="abstract-1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract-1">Abstract</h2>
<p>Since 2010, central Chile is experiencing a multi-dimensional crisis due to the pervasive impacts of the ongoing mega drought. Political institutions and stakeholders have responded reactively to socio-economic crises associated with the mega drought as they emerge (particularly in the agricultural and health sectors),. While governments should move towards risk-based management (Wilhite et al.&nbsp;2014), they require robust decision-making tools to facilitate the transition. One such tool are early warning systems (EWS), which aim to reduce vulnerability and to improve response capacity of people at risk. However, the current observatory developed for Chile, the Chilean Agroclimatic Observatory (Verbist et al., 2016), was mainly designed for scientific research and has a poor user experience (UX).</p>
<p>To this end, we propose the development of a multi-scale drought observatory for Chile that will help mitigate agricultural and ecological impacts. Using a macrosystems perspective (Heffernan et al.&nbsp;2014), this observatory will integrate global climate and land satellite data with in-situ measurements from national weather stations. It will have two main components: i) monitoring climate and land variables and their impacts on agricultural and socio-ecological systems, and ii) a drought early warning system (DEWS). The drought monitoring and DEWS platforms will target three user groups – the general public, decision makers , and the scientific community - and will comply with FAIR data principles (Wilkinson et al.&nbsp;2016), to enhance usability of all products. We will monitor drought-related variables at two spatial scales: the national scale (Fig. 1a) and at ii) the local scale, for which we selected the Aconcagua watershed (Fig 1b). Local-scale measurements will also be used to validate and improve drought monitoring at the national scale. We selected this watershed for two reasons: i)it has been highly impacted by drought, which have triggered several conflicts this year (2021)between agricultural interests and groups concerned with access to drinking water; and ii) this watershed will provide a preview of the future for other watersheds that have yet to experience the evolving, multi-dimensional impacts of similarly extreme droughts.</p>
<p><a href="https://odes-chile.org">Click to go to webpage</a></p>
<hr>
</section>
</section>
<section id="satori-satellite-system-for-irrigation-optimization" class="level1" data-toc-text="Irrigation Optimization - SatOri" data-number="3">
<h1 data-toc-text="Irrigation Optimization - SatOri" data-number="3"><span class="header-section-number">3</span> SatOri: Satellite System for Irrigation Optimization</h1>
<p><strong>Fund Name:</strong> FONDEF IDeA I+D<br>
<strong>Fund Agency:</strong> National Research and Development Agency (ANID)<br>
<strong>Year:</strong> 2020<br>
<strong>Fund total amount:</strong> 200 millions chilean pesos ($CLP)</p>
<section id="abstract-2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract-2">Abstract</h2>
<p>Water scarcity due to climate change has severely impacted agriculture in central Chile, making efficient irrigation management a critical need. This project aims to develop SatOri, a low-cost, satellite-based decision-support service to optimize irrigation in kiwi and cherry orchards. The innovation integrates two key components: (1) determination of optimal deficit irrigation strategies (RDC) that reduce water use without compromising yield or fruit quality, and (2) estimation of canopy water status—specifically leaf turgor potential—through machine learning models based on multispectral and radar satellite data (Sentinel-1, Sentinel-2, Landsat 8).</p>
<p>The research involves field trials with varying irrigation treatments and continuous monitoring of plant water status using Scholander chambers, ZIM turgor sensors, and chlorophyll fluorescence. Satellite indices in the VNIR, SWIR, and microwave ranges are evaluated as predictors of plant hydration. The optimal irrigation regime will be validated in the second season, and a prototype web platform will be built to provide near-real-time irrigation recommendations using open satellite imagery and cloud-based infrastructure.</p>
<p>By focusing on plant response rather than indirect climatic indicators, SatOri promises a scalable, farmer-friendly tool for adaptive irrigation under increasing water limitations—contributing to sustainable agriculture and climate resilience in Chile and beyond.</p>
<p><a href="https://s4tori.cl">Click to go to webpage</a></p>
<hr>
</section>
</section>
<section id="the-impact-of-weather-variability-on-wheat-and-maize-production-an-improved-early-warning-model-for-agricultural-drought" class="level1" data-toc-text="Wheat/Maize AGB prediction" data-number="4">
<h1 data-toc-text="Wheat/Maize AGB prediction" data-number="4"><span class="header-section-number">4</span> The impact of weather variability on wheat and maize production: an improved early warning model for agricultural drought</h1>
<p><strong>Fund Name:</strong> FONDECYT de Iniciación en Investigación 2019<br>
<strong>Fund Agency:</strong> National Research and Development Agency (ANID)<br>
<strong>Year:</strong> 2019<br>
<strong>Fund total amount:</strong> 100 millions chilean pesos ($CLP)</p>
<section id="abstract-3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract-3">Abstract</h2>
<p>Global food security is negatively affected by drought. Climate projections show that drought frequency and intensity may increase in different parts of the globe. These increases are particularly hazardous for developing countries. Early season forecasts on drought occurrence and severity could help to better mitigate its negative consequences. Chile is facing what some authors have been calling a mega-drought. Recent studies showed a tendency toward a drier condition (1960-2016) in the central-southern part (30-48°) and indicated that the future projections condition could be potentially underestimated for this region. Recent analyses reveal that 52% of the area under wheat in Chile would face a serious decline in rainfall in 2030-2050. Hence, the country is under urgent need of taking action regarding adaptation measures. The early warning system is the first step for adaptation -if it is possible to anticipate the impact, then it will be feasible to do something to diminish the losses- for which are of increasing need. The understanding of how environmental variables (i.e., precipitation, soil moisture, temperature) impact vegetation productivity under the current climate change will allow improving early warning models.</p>
<p>The standard practice for food security assessments at a regional scale is by the monitoring of drought that affects agriculture using vegetation indices (Vis). Such systems offer food security alerts at a medium spatial resolution that are not detailed enough to detect the emergence of local food insecurity conditions and often leverage remote sensing only in a qualitative sense. To account for the impact in yield quantitatively, there is a lack of crop production data (yield, surface, production) worldwide that need to will. Recent improvements in the spatial, spectral and temporal resolutions of Earth Observations satellites (EO) hold significant potential for improved food security assessments. This project aims to develop a near-real-time seasonal prediction model for agricultural drought impact on maize and wheat in central Chile. Were defined three objectives considering wheat and maize: I) select a proxy for biomass from multiple satellite data with similar spectral but different spatial resolution (10m and 250m); 2) develop a biomass estimation model from the proxy derived from public satellite data; and 3) develop a seasonal prediction model for yield from multiple satellite estimates of vegetation, precipitation, soil moisture, and land surface temperature. Throughout the project will be analyzed high spatial resolution satellite data from sensor Sentinel-2 and Landsat 8 OLI by using the new “sen2-Agri” system which allows for ingesting it and retrieving the phenology (start, end, and length of the growing season) and spectral vegetation indices. Also, coarse spatial resolution data from sensor MODIS product MOD13Q1 collection 6 was considered for which will be developed a model to extract phenology and compare it with the one derived from the high-resolution data. For both will be calculated proxies for biomass at different times through the season which will be validated with infield measures of wheat and maize, allowing to develop a biomass model (BM). This BM will be used to obtain yield data by calculating biomass at the end of the season (EOS) and so be able to reconstruct historical records (2000-2022).</p>
<p>The last stage of the project consists in the developing of a prediction model for wheat and maize yield, from satellite environmental data of soil moisture, precipitation, land surface temperature and the proxy of yield itself following a similar approach as in Zambrano et al.&nbsp;(2018). Two models will be tested regardless the availability of soil moisture data, one considering the period 2015-2022 in which all the described variables will be used (M1), and the second by discard soil moisture and defined through for 2000-2022 (M2). The prediction lead-time used will be one to six month before the EOS. It expected that the results of this project could help to anticipate losses on wheat and maize, and so contribute to adaptation measures, and to improves early warning system at a local scale. As the data used here are publicly available globally, the models obtained could be adopted around the globe.</p>


</section>
</section>

</main> <!-- /main -->
<script>
  function abbrv_toc() {
    let toc = document.querySelectorAll('nav#TOC li>a');
    toc.forEach(e => {
      let id = e.id.substring(4);
      let sec = document.getElementById(id);
      let toc_text = sec.getAttribute('data-toc-text');
      if(toc_text != null) {
        let new_toc_text = e.querySelector('span').outerHTML + ' ' + toc_text;
        e.innerHTML = new_toc_text;
      }
    })
  };

  window.document.addEventListener("DOMContentLoaded", function (event) {
    abbrv_toc();
  });
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/francisco-zambrano\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>